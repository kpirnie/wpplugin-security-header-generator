const _initial_values={},cspFieldBackups={};document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.querySelectorAll('[data-depend-id^="generate_csp_custom_"]').forEach(function(e){const t=e.getAttribute("data-depend-id");if(!t.endsWith("_allow_unsafe")){const n=t.replace("generate_csp_custom_","");_initial_values[n]=e.value||""}})},250),document.querySelectorAll('[data-depend-id^="generate_csp_custom_"]').forEach(function(e){e.getAttribute("data-depend-id").endsWith("_allow_unsafe")||(e.addEventListener("change",updateInitialValue),e.addEventListener("blur",updateInitialValue),e.addEventListener("keyup",updateInitialValue))});const c=document.querySelector('[data-depend-id="include_acam_methods"][value="*"]');c&&c.addEventListener("click",function(){const e=this.checked;document.querySelectorAll('[data-depend-id="include_acam_methods"]').forEach(function(n){n.checked=e})}),handleNoneCSP()}),document.addEventListener("change",function(c){if(c.target.matches('[name="wpsh_settings[apply_csp_preset]"]')){const e=c.target.value;if(console.log("Preset selected:",e),!e||e==="none")return;if(typeof wpshPresets>"u"){console.error("wpshPresets not defined");return}console.log("Making AJAX request...");const t=new FormData;t.append("action","wpsh_load_preset"),t.append("preset_key",e),t.append("nonce",wpshPresets.nonce),fetch(wpshPresets.ajaxurl,{method:"POST",body:t}).then(n=>(console.log("Response received:",n),n.json())).then(n=>{console.log("Data:",n),n.success&&n.data.settings?applyPresetSettings(n.data.settings):console.error("Error in response:",n)}).catch(n=>console.error("Error loading preset:",n))}});function applyPresetSettings(c){console.log("Applying settings:",c),document.querySelectorAll('[data-depend-id^="generate_csp_custom_"]').forEach(function(e){e.type==="checkbox"?e.checked=!1:(e.type==="text"||e.type==="textarea")&&(e.value="")}),Object.keys(c).forEach(function(e){let t=document.querySelector(`[name="wpsh_settings[${e}]"]`);if(t||(t=document.querySelector(`[data-depend-id="${e}"]`)),!t){console.log("Field not found:",e);return}console.log("Found field:",e,t);const n=c[e];if(t.type==="checkbox"){const o=document.querySelectorAll(`[name="wpsh_settings[${e}][]"]`);o.length>0?o.forEach(function(d){Array.isArray(n)&&(d.checked=n.includes(parseInt(d.value)))}):t.checked=n}else t.type==="radio"?document.querySelectorAll(`[name="wpsh_settings[${e}]"]`).forEach(function(d){d.checked=d.value===n}):t.value=n;t.dispatchEvent(new Event("change",{bubbles:!0}))})}function updateInitialValue(c){const t=c.target.getAttribute("data-depend-id").replace("generate_csp_custom_","");_initial_values[t]!==void 0&&(_initial_values[t]=c.target.value||"")}function backupAndClearFields(c){const e=c.getAttribute("data-depend-id"),t=getFieldIdFromCheckboxId(e),n=document.querySelector(`[data-depend-id="${t}"]`);if(!n)return;cspFieldBackups[t]||(cspFieldBackups[t]=n.value),n.value="";const o=t.replace("generate_csp_custom_","");_initial_values[o]!==void 0&&(_initial_values[o]="")}function restoreFields(c){const e=c.getAttribute("data-depend-id"),t=getFieldIdFromCheckboxId(e),n=document.querySelector(`[data-depend-id="${t}"]`);if(n&&cspFieldBackups[t]!==void 0){n.value=cspFieldBackups[t];const o=t.replace("generate_csp_custom_","");_initial_values[o]!==void 0&&(_initial_values[o]=cspFieldBackups[t]),delete cspFieldBackups[t]}}function getFieldIdFromCheckboxId(c){return c.replace("_allow_unsafe","")}function getCheckboxGroupId(c){return c.getAttribute("data-depend-id").replace(/_allow_unsafe$/,"")}function handleNoneCSP(){document.addEventListener("change",function(c){const e=c.target,t=e.getAttribute("data-depend-id");if(t&&t.endsWith("_allow_unsafe")){const n=t.replace("_allow_unsafe",""),o=e.value==="3",d=e.checked,a=document.querySelectorAll(`[data-depend-id="${n}_allow_unsafe"]`);o&&d?(a.forEach(function(s){s!==e&&(s.checked=!1)}),backupAndClearFields(e)):!o&&d&&(a.forEach(function(s){s.value==="3"&&(s.checked=!1)}),Object.keys(cspFieldBackups).length>0&&restoreFields(e))}})}String.prototype.remDups=function(){return[...new Set(this.split(" "))].join(" ")};
